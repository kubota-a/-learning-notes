# 📝 メモアプリ（Flask）  
Flask・SQLAlchemy・Jinja2 を使用した、学習用の CRUD メモアプリです。  
ログイン機能、ユーザー登録、メモの作成 / 編集 / 削除機能を実装しています。

---

## 🚀 機能一覧

### 🔐 認証（Authentication）
- ユーザー登録（signup）
- ログイン・ログアウト機能
- パスワードハッシュ化（Werkzeug）

### 🗂 メモ管理（CRUD）
- メモ一覧表示
- メモ作成（登録）
- メモ編集
- メモ削除（確認画面あり）

### 🔒 認可（Authorization）
- ログインしていない場合は保護ページへアクセス不可  
  → 自動で `/login?next=...` にリダイレクト

---

## 🧪 テスト項目一覧（Test Scenarios）

> 追加機能ごとに「正常系・戻る/遷移・更新/連打・入力チェック・重複/一意性・未ログイン・存在しないID」を最低1回は確認する

開発中に毎回同じ観点でテストできるように標準化した項目一覧です。  
MVP形式の高速開発にも使えるよう、項目を最小にまとめています。

---

### A. 正常系（Functional / Happy Path）
- [x] ユーザー登録ができる  
- [x] ログインできる  
- [x] メモを作成できる  
- [x] メモを編集できる  
- [x] メモを削除できる  
- [x] ログアウトできる（POST）

---

### B. 戻る・画面遷移（Navigation）
- [x] 編集画面：内容を変更せず「一覧に戻る」でトップに戻れる  
- [x] 削除画面：削除せず「一覧に戻る」でトップに戻れる  
- [x] 一覧画面：各メモの編集リンクが正しい ID に遷移する（404 にならない）  
- [x] 一覧画面：各メモの削除リンクが正しい ID に遷移する（404 にならない）

---

### C. 更新・二重実行（Reload / Double Action）
- [x] 編集画面：`/<id>/edit` で F5 更新しても正しくフォームが表示される  
- [x] 削除画面：`/<id>/delete` で F5 更新しても誤って削除されない

---

### D. 入力チェック（Validation）
- [x] signup：userid が空 → エラー  
- [x] signup：password が空白のみ → エラー  
- [x] login：userid/password が空 → ログイン不可

---

### E. 一意性（Uniqueness）
- [x] signup：既存の userid で再登録 → エラーになる

---

### F. 認可（Authorization）
- [x] 未ログインで `/` → ログインページへ  
- [x] 未ログインで `/regist` → ログインページへ  
- [x] 未ログインで `/<id>/edit` → ログインページへ  
- [x] 未ログインで `/<id>/delete` → ログインページへ

#### 🔁 ログイン後の復帰（next リダイレクト）
- [x] 未ログインで `/` → ログイン成功後 `/` に戻る  
- [x] 未ログインで `/regist` → ログイン成功後 `/regist` に戻る

---

### G. 異常系（Edge Cases）> ※ログインした状態でのみテストする（未ログインだと認可のチェックが先に入ってログインに飛ばされてしまうため）
- [ ] 存在しない ID の編集 `/9999/edit` → 404（Not Found）  
- [ ] 存在しない ID の削除 `/9999/delete` → 404（Not Found）

---

## 🧪 テスト手順（Test Procedures）

開発中に実施する各テストの手順をまとめています。  
「期待結果」を明記することで、テスト品質と再現性を担保します。

---

### 0. 事前条件
- DB が初期化されていること（ユーザー登録可能な状態）  
- ログインしていない状態で開始（シークレットウィンドウ推奨）

---

### 1. サインアップ（ユーザー登録）

**手順**  
1. `/signup` を開く  
2. userid / password を入力して登録ボタンを押す  

**期待結果**  
- 新規登録フォームが正しく表示される  
- 登録成功メッセージが表示され、`/login` に遷移する

---

### 2. ログイン

**手順**  
1. `/login` を開く  
2. 正しい userid / password を入力してログインする  

**期待結果**  
- ログイン画面が表示される  
- 「ログインしました。」のメッセージとともに `/` に遷移する

---

### 3. メモ作成

**手順**  
1. `/regist` を開く  
2. タイトル / 本文を入力して登録ボタンを押す  

**期待結果**  
- 作成フォームが正しく表示される  
- 登録後 `/` に戻り、作成したメモが一覧に表示される

---

### 4. メモ編集

**手順**  
1. 対象メモの `/<id>/edit` を開く  
2. 内容を変更して更新ボタンを押す  

**期待結果**  
- 編集フォームが正しく表示される  
- 更新後 `/` に戻り、編集内容が一覧に反映される

**追加テスト（編集）**  
- `/<id>/edit` を F5（更新）しても正しくフォームが表示される  
- 変更せずに「一覧に戻る」で正常に `/` に遷移する  

---

### 5. メモ削除

**手順**  
1. 対象メモの `/<id>/delete` を開く  
2. 削除ボタンを押す  

**期待結果**  
- 削除確認画面が表示される  
- 削除後 `/` に戻り、対象のメモが一覧から削除されている

**追加テスト（削除）**  
- 削除ページで F5（更新）しても誤って削除されない  
- 削除せずに「一覧に戻る」で正常に `/` に遷移する  

---

### 6. ナビゲーション（戻るボタン・リンク正常性）

**手順**  
1. 一覧 `/` を表示  
2. 任意のメモの「編集」「削除」リンクを順番にテスト  

**期待結果**  
- 編集リンクが正しい URL（`/<id>/edit`）に遷移する  
- 削除リンクが正しい URL（`/<id>/delete`）に遷移する  
- 404 が出ない  
- 外れた ID に飛ぶリンクが存在しない  

---

### 7. ログアウト

**手順**  
1. ログアウト操作（POST）を実行する  

**期待結果**  
- 「ログアウトしました。」のメッセージが表示され `/login` に戻る

---

## 🧪 自動テスト（pytest）

本アプリでは、Flask のテストクライアントと pytest を用いて  
**認証・認可・メモ CRUD の主要動作を自動化**しています。

テストコードは以下の 3 ファイルで構成されています。

### 📄 テスト構成

| ファイル | 役割 |
|---------|------|
| `tests/test_user.py` | パスワードハッシュの検証、ユーザー登録の動作確認 |
| `tests/test_auth.py` | 未ログイン時のリダイレクト（認可）動作の検証 |
| `tests/test_memo.py` | ログイン後のメモ作成・編集・削除（CRUD）動作の検証 |

### 🔧 テスト環境

- `conftest.py` にてテスト専用の SQLite DB を自動生成  
- `unique_userid` Fixture によりテストごとにユニークなユーザーを使用  
- `logged_in_client` Fixture により、ログイン済み状態のクライアントを提供  
- 実アプリのルーティングや DB をそのまま利用し、実運用に近い形で検証

### ▶ 実行方法

```bash
uv run pytest -q

---

### 🛠 セットアップ

### 1. 仮想環境
```bash
python -m venv venv
source venv/bin/activate   # or venv\Scripts\activate
